# Offline Games App - Phase 2: Five New Features

## Context
The app has 3 working games (Tic Tac Toe, Snake, 2048) with difficulty selection, dark theme, high scores, and web+mobile support. Now adding: Themes, Sound Effects, Stats Tracking, Animations, and 3 More Games (Minesweeper, Connect Four, Tetris).

---

## Implementation Order

Themes first (changes how every component reads colors), then Sound, Stats, Animations, and finally new Games (so they use all the new systems from day one).

---

## Phase 1: Themes

**New files:**
- `src/utils/themes.ts` — `ThemeColors` interface, `ThemeId` type, 4 theme palettes (Dark, Light, Retro, Ocean)
- `src/contexts/ThemeContext.tsx` — React context + `useTheme()` hook, loads/saves theme to AsyncStorage

**Migration pattern:** Every component that uses `COLORS` switches to `const { colors } = useTheme()` with styles in `useMemo(() => StyleSheet.create({...}), [colors])`.

**4 themes:** Dark (current), Light (white/gray), Retro (warm amber/orange), Ocean (deep blue/cyan)

**Files to modify:**
- `App.tsx` — wrap in `<ThemeProvider>`, dynamic nav header colors
- `src/utils/constants.ts` — remove `COLORS` export
- `src/types/index.ts` — add shared `RootStackParamList` (consolidate duplicates)
- All components + screens + game files — replace `COLORS` import with `useTheme()`
- `SettingsScreen.tsx` — add theme picker UI with color swatches

---

## Phase 2: Sound Effects

**New dependency:** `expo-av`

**New files:**
- `assets/sounds/*.wav` — 8 simple sound files generated by a Node.js script (sine wave beeps/tones)
- `src/utils/sounds.ts` — preload cache, `playSound()` function
- `src/contexts/SoundContext.tsx` — context + `useSound()` hook with mute toggle (saved to AsyncStorage)

**Sounds:** tap, win, lose, eat, merge, drop, clear, flag

**Where they play:**
- TTT: tap on cell, win/lose jingle
- Snake: eat on food, lose on death, tap on d-pad
- 2048: merge on tile combine, win/lose
- Settings: mute/unmute toggle

**Files to modify:** `App.tsx` (wrap in `<SoundProvider>`), `SettingsScreen.tsx` (mute toggle), all 3 game components

---

## Phase 3: Stats Tracking

**New files:**
- `src/utils/stats.ts` — `recordGameResult(gameId, 'win'|'loss', timeSeconds)`, `getAllStats()`, `clearAllStats()`
- `src/screens/StatsScreen.tsx` — per-game stat cards (games played, win rate, time played)

**Data model:** `{ gamesPlayed, wins, losses, totalTimeSeconds }` per game, stored as single JSON blob in AsyncStorage.

**Win/loss definitions:**
- TTT: win = player wins, loss = AI wins or draw
- Snake: win = score > 0, loss = score = 0
- 2048: win = reached 2048, loss = board fills
- Same pattern for new games

**Each game gets:** a `startTimeRef` and calls `recordGameResult()` on game end.

**Files to modify:** `App.tsx` (add Stats route), `types/index.ts` (add GameStats type, Stats route), `HomeScreen.tsx` (stats button), `SettingsScreen.tsx` (clear stats button), all game components (time tracking + record calls)

---

## Phase 4: Animations

**No new dependencies** — uses React Native built-in `Animated` API.

**New file:** `src/components/AnimatedButton.tsx` — press scale feedback (0.95 on press, spring back)

**Per-game animations:**
- TTT: X/O scale pop (spring from 0→1 when placed)
- Snake: food cell pulses (looping scale 0.85↔1.15)
- 2048: merge pop (scale 1→1.15→1), new tile fade-in (scale 0→1)

**Files to modify:** TTT, Snake, 2048 components (add Animated.Values), GameCard + DifficultyPicker (use AnimatedButton)

---

## Phase 5: Three New Games

### Minesweeper (`src/games/Minesweeper/`)

**Difficulty:**
| Level | Grid | Mines |
|-------|------|-------|
| Easy | 8x8 | 10 |
| Medium | 12x12 | 25 |
| Hard | 16x16 | 50 |

- Tap to reveal, long-press (or right-click on web) to flag
- Board generated on first click (guarantees safe opening)
- Flood-fill reveal for 0-adjacent cells
- Standard number colors (1=blue, 2=green, 3=red, etc.)

### Connect Four (`src/games/ConnectFour/`)

**Difficulty (AI smartness):** Easy=30%, Medium=60%, Hard=90% optimal moves
- 7x6 grid, tap column to drop piece
- Player=Red vs AI=Yellow
- AI uses depth-limited minimax with alpha-beta pruning (depth 6)
- Keyboard support: 1-7 keys for columns on web

### Tetris (`src/games/Tetris/`)

**Difficulty:**
| Level | Start Speed | Speed-up |
|-------|------------|----------|
| Easy | 800ms | -30ms/level |
| Medium | 600ms | -40ms/level |
| Hard | 400ms | -50ms/level |

- 20x10 grid, 7 standard tetrominoes with 7-bag randomization
- Controls: Left, Right, Rotate, Soft Drop, Hard Drop buttons (+ keyboard on web)
- Ghost piece preview, next piece display
- Scoring: 1 line=100, 2=300, 3=500, 4 (Tetris)=800, multiplied by level
- Min tick speed capped at 100ms

**Registration:** Expand `GameId` type, add to `GAMES` array, add switch cases in `GameScreen.tsx`, add titles in `App.tsx`

---

## Verification

After each phase:
1. `npx tsc --noEmit` — zero TypeScript errors
2. Refresh http://localhost:8081 — test in browser
3. Verify all existing games still work
4. Test the new feature specifically

---

## New Dependency
```
npx expo install expo-av
```
(Only addition — everything else uses built-in APIs)
